# Task W1.T01 Output Notes

## Implementation Summary

Implemented four core geometry types for CSS layout:
- **Point**: 2D coordinates (x, y) in CSS pixels
- **Size**: 2D dimensions (width, height)
- **Rect**: Axis-aligned rectangle (origin + size)
- **EdgeOffsets**: Four-sided spacing (top, right, bottom, left)

All types are Copy, have zero constants, and include comprehensive utility methods.

## API Contracts

### Public Types

```rust
#[derive(Debug, Clone, Copy, PartialEq)]
pub struct Point {
    pub x: f32,
    pub y: f32,
}

#[derive(Debug, Clone, Copy, PartialEq)]
pub struct Size {
    pub width: f32,
    pub height: f32,
}

#[derive(Debug, Clone, Copy, PartialEq)]
pub struct Rect {
    pub origin: Point,
    pub size: Size,
}

#[derive(Debug, Clone, Copy, PartialEq)]
pub struct EdgeOffsets {
    pub top: f32,
    pub right: f32,
    pub bottom: f32,
    pub left: f32,
}
```

### Key Methods

```rust
// Point
impl Point {
    pub const ZERO: Self;
    pub const fn new(x: f32, y: f32) -> Self;
    pub fn translate(self, other: Point) -> Self;
    pub fn distance_to(self, other: Point) -> f32;
}

// Size
impl Size {
    pub const ZERO: Self;
    pub const fn new(width: f32, height: f32) -> Self;
    pub fn area(self) -> f32;
    pub fn is_empty(self) -> bool;
    pub fn scale(self, factor: f32) -> Self;
}

// Rect
impl Rect {
    pub const ZERO: Self;
    pub const fn new(origin: Point, size: Size) -> Self;
    pub const fn from_xywh(x: f32, y: f32, width: f32, height: f32) -> Self;
    pub fn from_points(top_left: Point, bottom_right: Point) -> Self;
    pub fn center(self) -> Point;
    pub fn contains_point(self, point: Point) -> bool;
    pub fn intersects(self, other: Rect) -> bool;
    pub fn union(self, other: Rect) -> Rect;
    pub fn intersection(self, other: Rect) -> Option<Rect>;
    pub fn translate(self, offset: Point) -> Rect;
    pub fn inflate(self, amount: f32) -> Rect;
    // Plus many accessor methods (x, y, width, height, min_x, etc.)
}

// EdgeOffsets
impl EdgeOffsets {
    pub const ZERO: Self;
    pub const fn all(value: f32) -> Self;
    pub const fn new(top: f32, right: f32, bottom: f32, left: f32) -> Self;
    pub const fn symmetric(vertical: f32, horizontal: f32) -> Self;
    pub fn horizontal(self) -> f32;
    pub fn vertical(self) -> f32;
}
```

## Decisions Made

### Decision 1: Use f32 Instead of f64

**Choice:** All coordinates and dimensions use `f32`
**Rationale:**
- CSS layout calculations don't need f64 precision
- f32 is faster and uses less memory
- Browsers use float (f32 equivalent) internally
- Reduces cache pressure for large fragment trees

**Impact:** Downstream tasks should use f32 consistently

### Decision 2: Make All Types Copy

**Choice:** All geometry types derive Copy
**Rationale:**
- Small types (8-16 bytes)
- Passed by value is more efficient than references
- Simplifies API (no lifetime annotations needed)
- Follows Rust idiom for small data types

**Impact:** Can pass by value without performance concerns

### Decision 3: Fields are Public

**Choice:** All struct fields are public (not using accessors for all operations)
**Rationale:**
- Simpler API, less boilerplate
- These are simple data types with no invariants
- Still provide methods for common operations
- Follows Rust's Point/Size/Rect idiom

**Alternatives Considered:** Private fields with getters/setters - rejected as too verbose for simple types

## Spec Interpretations

### Coordinate System Origin

**Spec says:** CSS 2.1 uses top-left origin with +Y downward
**Interpretation:** Point(0, 0) is top-left, +X right, +Y down
**Reasoning:** Matches CSS coordinate system exactly
**Test coverage:** Implicit in all tests using positive coordinates

## Discoveries & Gotchas

### Discovery 1: Intersection Edge Cases

**What:** Rectangles that touch at edges/corners should be considered intersecting
**Why it matters:** Affects hit testing and paint optimization
**Recommendation:** Use `<=` not `<` in intersection tests

### Gotcha 1: Floating Point Equality

**Problem:** Comparing f32 with `==` can fail due to precision
**Solution:** For tests, use `(a - b).abs() < epsilon` when needed
**Warning:** Production code should avoid exact floating point comparisons. Note that `PartialEq` is derived, so `==` checks for exact bitwise equality. Be careful when comparing results of calculations.

## Performance Notes

### Performance Characteristics

- All operations are O(1)
- No allocations (all types are Copy)
- Methods are inline-friendly (most will be inlined)

### Optimization Opportunities

- **SIMD**: Rect operations (union, intersection) could use SIMD in hot paths
- **Future**: Consider adding `Rect::from_points_batch()` for bulk operations

## Recommendations for Downstream Tasks

### For Task W2.T01 (BoxNode Type):

- Use `Rect::ZERO` as placeholder for unpositioned boxes
- Remember that boxes don't have positions yet (only fragments do)
- Use `Size` for intrinsic sizes

### For Task W2.T03 (FragmentNode Type):

- Fragments MUST have valid Rect (positioned and sized)
- Use `Rect::translate()` for positioning children
- Use `Rect::union()` for computing bounding boxes

### For Task W2.T05 (ComputedStyle):

- Use `EdgeOffsets` for margin, padding, border
- Remember to use `.horizontal()` and `.vertical()` when computing total box size

## Open Questions

None - geometry types are straightforward with well-defined semantics.

## Test Coverage

### What's Tested

- ✅ All constructors (new, from_xywh, all, symmetric, etc.)
- ✅ Zero constants
- ✅ Accessor methods (x, y, width, height, min_x, max_x, etc.)
- ✅ Geometric operations (contains, intersects, union, intersection)
- ✅ Transformations (translate, inflate, scale)
- ✅ Edge cases (empty sizes, boundary conditions)

### What's Not Tested (Gaps)

- ❌ SIMD performance (not relevant until profiling shows need)
- ❌ Precision edge cases with very large/small numbers (not expected in practice)

### Test Statistics

- Unit tests: 23 tests covering all public APIs
- All tests pass: ✅
- Clippy warnings: 0

## Code Quality

- ✅ Clippy passes with no warnings
- ✅ Rustfmt applied
- ✅ All public APIs documented with rustdoc
- ✅ Examples in all public API documentation
- ✅ Display trait implemented for debugging

## References Used

1. CSS 2.1 Section 8.3.1 (Coordinate System) - https://www.w3.org/TR/CSS21/coords.html
2. Rust std::f32 documentation
3. WebRender's geometry types (for inspiration on API design)
