---
task_id: "W4.T05"
title: "Implement Shaping Pipeline"
wave: 4
estimated_hours: 6-8
depends_on:
  - "W4.T01"
  - "W4.T02"
  - "W4.T03"
inputs:
  - "outputs/notes/W4.T01-notes.md"
  - "outputs/notes/W4.T02-notes.md"
  - "outputs/notes/W4.T03-notes.md"
outputs:
  - "src/text/pipeline.rs"
  - "tests/text/test_pipeline.rs"
  - "outputs/notes/W4.T05-notes.md"
skills_required:
  - "Rust"
  - "Text processing pipeline"
context_files:
  - "docs/plan/03-text-shaping.md"
verification:
  - "cargo test text::pipeline"
---

# Implement Shaping Pipeline

## Context

The shaping pipeline coordinates bidi analysis, script itemization, and text shaping into a unified process.

## Implementation

```rust
pub struct ShapingPipeline {
    font_context: FontContext,
}

impl ShapingPipeline {
    pub fn shape(&mut self, text: &str, style: &ComputedStyle) -> Vec<ShapedRun> {
        // 1. Bidi analysis
        let bidi_runs = analyze_bidi(text);
        
        // 2. Script itemization
        // 3. Font matching per script
        // 4. Shape each run
        // 5. Combine results
    }
}

pub struct ShapedRun {
    pub glyphs: Vec<GlyphPosition>,
    pub direction: Direction,
}
```

## Testing

Tests (20+):
- Simple LTR text
- RTL text
- Mixed scripts
- Complex text (Arabic)
- Full pipeline integration

Time: 6-8 hours
