---
task_id: "W3.T17"
title: "Implement Font Fallback Chain"
wave: 3
estimated_hours: 4-6
depends_on:
  - "W3.T15"
inputs:
  - "outputs/notes/W3.T15-notes.md"
outputs:
  - "src/text/font/fallback.rs"
  - "tests/text/test_font_fallback.rs"
  - "outputs/notes/W3.T17-notes.md"
skills_required:
  - "Rust"
  - "CSS font-family resolution"
context_files:
  - "docs/plan/03-font-system.md"
verification:
  - "cargo test text::font_fallback"
---

# Implement Font Fallback Chain

## Context

Font fallback handles font-family lists like "Roboto, Arial, sans-serif" - trying each font until one is found that contains the needed glyphs.

CSS Fonts Module Level 4, Section 5.

## Implementation

```rust
pub struct FallbackChain {
    families: Vec<String>,
}

impl FallbackChain {
    pub fn resolve(&self, c: char, db: &FontDatabase) -> Option<FontId> {
        // Try each family in order
        // Check if font has glyph for character
        // Return first match
    }
}
```

## Testing

Tests (15+):
- Basic fallback chain
- Generic families (sans-serif, serif, monospace)
- Missing glyphs â†’ fallback
- Emoji handling

Time: 4-6 hours
