---
task_id: "W3.T08"
title: "Implement Flex Layout Wrapper (Taffy Integration)"
wave: 3
estimated_hours: 6-8
depends_on:
  - "W2.T07"
inputs:
  - "outputs/notes/W2.T07-notes.md"
outputs:
  - "src/layout/contexts/flex.rs"
  - "tests/layout/test_flex.rs"
  - "outputs/notes/W3.T08-notes.md"
skills_required:
  - "Rust"
  - "Taffy flexbox library"
  - "CSS Flexbox"
context_files:
  - "docs/plan/02-flex-layout.md"
verification:
  - "cargo test layout::flex"
---

# Implement Flex Layout Wrapper

## Context

Flexbox is complex enough that we use Taffy library instead of implementing from scratch. This task wraps Taffy's flexbox algorithm in our FormattingContext interface.

### Background

**Taffy Integration:**
- Use `taffy` crate for flexbox
- Convert BoxNode → Taffy tree
- Run Taffy layout
- Convert Taffy results → FragmentNode

**Key mappings:**
- CSS flex properties → Taffy style
- BoxNode children → Taffy nodes
- Taffy layout → Fragment positions

## Implementation

```rust
use taffy::prelude::*;

pub struct FlexFormattingContext {
    taffy: TaffyTree<()>,
}

impl FormattingContext for FlexFormattingContext {
    fn layout(&self, box_node: &BoxNode, constraints: &LayoutConstraints) 
        -> Result<FragmentNode> {
        // 1. Build Taffy tree from BoxNode
        // 2. Set constraints
        // 3. Run taffy.compute_layout()
        // 4. Extract results → FragmentNode
    }
}
```

## Testing

Tests (15+):
- Basic flex container
- flex-direction variations
- justify-content/align-items
- flex-grow/shrink
- Nested flex

Time: 6-8 hours
