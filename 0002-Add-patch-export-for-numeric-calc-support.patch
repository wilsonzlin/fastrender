From 5fabb4f54cacca1cce585d5d9a4a4d7a292dd1a7 Mon Sep 17 00:00:00 2001
From: Wilson Lin <code@wilsonl.in>
Date: Wed, 17 Dec 2025 23:56:49 -0500
Subject: [PATCH 2/2] Add patch export for numeric calc support

---
 ...min-max-clamp-for-numeric-properties.patch | 111 ++++++++
 local_patches/ahead-two-commits.patch         | 242 ++++++++++++++++++
 scratchpad.md                                 |   1 +
 3 files changed, 354 insertions(+)
 create mode 100644 0001-Support-calc-min-max-clamp-for-numeric-properties.patch
 create mode 100644 local_patches/ahead-two-commits.patch

diff --git a/0001-Support-calc-min-max-clamp-for-numeric-properties.patch b/0001-Support-calc-min-max-clamp-for-numeric-properties.patch
new file mode 100644
index 0000000..522fff6
--- /dev/null
+++ b/0001-Support-calc-min-max-clamp-for-numeric-properties.patch
@@ -0,0 +1,111 @@
+From 78778459c7c579e0e2403fba9ebc97eab9249838 Mon Sep 17 00:00:00 2001
+From: Wilson Lin <code@wilsonl.in>
+Date: Wed, 17 Dec 2025 23:44:30 -0500
+Subject: [PATCH] Support calc/min/max/clamp for numeric properties
+
+---
+ local_patches/5a7b075-calc-numeric.patch | 51 ++++++++++++++++++++++++
+ scratchpad.md                            |  2 +
+ tests/css_numeric_functions.rs           | 22 ++++++++++
+ 3 files changed, 75 insertions(+)
+ create mode 100644 local_patches/5a7b075-calc-numeric.patch
+ create mode 100644 tests/css_numeric_functions.rs
+
+diff --git a/local_patches/5a7b075-calc-numeric.patch b/local_patches/5a7b075-calc-numeric.patch
+new file mode 100644
+index 0000000..ea5714d
+--- /dev/null
++++ b/local_patches/5a7b075-calc-numeric.patch
+@@ -0,0 +1,51 @@
++From 5a7b07514b262d302d3d3ab1e4679e0e12b9606c Mon Sep 17 00:00:00 2001
++From: Wilson Lin <code@wilsonl.in>
++Date: Wed, 17 Dec 2025 23:44:30 -0500
++Subject: [PATCH] Support calc/min/max/clamp for numeric properties
++
++---
++ scratchpad.md                  |  1 +
++ tests/css_numeric_functions.rs | 22 ++++++++++++++++++++++
++ 2 files changed, 23 insertions(+)
++ create mode 100644 tests/css_numeric_functions.rs
++
++diff --git a/scratchpad.md b/scratchpad.md
++index 65320e1..d42cac6 100644
++--- a/scratchpad.md
+++++ b/scratchpad.md
++@@ -1617,3 +1617,4 @@ Rendered getbootstrap.com at 1200×800: content fills viewport (bbox 0,12–1199
++ - fetch_and_render now uses HttpFetcher for network fetches (UA override honored), and render_pages logs the UA per-page to match runtime fetcher behavior.
++ - Unitless zero values now parse as numbers for opacity/z-index, avoiding bogus length parsing that could block overlays (e.g., wired.com); regression added.
++ - Push of the above scratchpad note pending; git push timing out (commit 363dbfd queued). Patch saved at local_patches/363dbfd-note-unitless-zero.patch for sharing.
+++- Numeric calc/min/max/clamp now parse for opacity/z-index: property parser accepts calc()/min()/max()/clamp() as numbers for numeric properties, with regression tests in css_numeric_functions.rs.
++diff --git a/tests/css_numeric_functions.rs b/tests/css_numeric_functions.rs
++new file mode 100644
++index 0000000..df8c18b
++--- /dev/null
+++++ b/tests/css_numeric_functions.rs
++@@ -0,0 +1,22 @@
+++use fastrender::css::properties::parse_property_value;
+++use fastrender::css::types::PropertyValue;
+++
+++fn as_number(prop: &str, value: &str) -> Option<f32> {
+++    match parse_property_value(prop, value)? {
+++        PropertyValue::Number(n) => Some(n),
+++        _ => None,
+++    }
+++}
+++
+++#[test]
+++fn numeric_properties_accept_calc_min_max_clamp() {
+++    assert_eq!(as_number("opacity", "calc(0.5)"), Some(0.5));
+++    assert_eq!(as_number("opacity", "min(0.5, 0.7)"), Some(0.5));
+++    assert_eq!(as_number("opacity", "max(0.3, 0.7)"), Some(0.7));
+++    assert_eq!(as_number("opacity", "clamp(0.2, 0.4, 0.6)"), Some(0.4));
+++
+++    assert_eq!(as_number("z-index", "calc(2)"), Some(2.0));
+++    assert_eq!(as_number("z-index", "min(1, 3)"), Some(1.0));
+++    assert_eq!(as_number("z-index", "max(5, 3)"), Some(5.0));
+++    assert_eq!(as_number("z-index", "clamp(1, 4, 6)"), Some(4.0));
+++}
++-- 
++2.43.0
++
+diff --git a/scratchpad.md b/scratchpad.md
+index 65320e1..dffca9b 100644
+--- a/scratchpad.md
++++ b/scratchpad.md
+@@ -1617,3 +1617,5 @@ Rendered getbootstrap.com at 1200×800: content fills viewport (bbox 0,12–1199
+ - fetch_and_render now uses HttpFetcher for network fetches (UA override honored), and render_pages logs the UA per-page to match runtime fetcher behavior.
+ - Unitless zero values now parse as numbers for opacity/z-index, avoiding bogus length parsing that could block overlays (e.g., wired.com); regression added.
+ - Push of the above scratchpad note pending; git push timing out (commit 363dbfd queued). Patch saved at local_patches/363dbfd-note-unitless-zero.patch for sharing.
++- Numeric calc/min/max/clamp now parse for opacity/z-index: property parser accepts calc()/min()/max()/clamp() as numbers for numeric properties, with regression tests in css_numeric_functions.rs.
++- Pushes currently timing out; latest numeric calc support saved as patch local_patches/5a7b075-calc-numeric.patch (commit 5a7b075 queued).
+diff --git a/tests/css_numeric_functions.rs b/tests/css_numeric_functions.rs
+new file mode 100644
+index 0000000..df8c18b
+--- /dev/null
++++ b/tests/css_numeric_functions.rs
+@@ -0,0 +1,22 @@
++use fastrender::css::properties::parse_property_value;
++use fastrender::css::types::PropertyValue;
++
++fn as_number(prop: &str, value: &str) -> Option<f32> {
++    match parse_property_value(prop, value)? {
++        PropertyValue::Number(n) => Some(n),
++        _ => None,
++    }
++}
++
++#[test]
++fn numeric_properties_accept_calc_min_max_clamp() {
++    assert_eq!(as_number("opacity", "calc(0.5)"), Some(0.5));
++    assert_eq!(as_number("opacity", "min(0.5, 0.7)"), Some(0.5));
++    assert_eq!(as_number("opacity", "max(0.3, 0.7)"), Some(0.7));
++    assert_eq!(as_number("opacity", "clamp(0.2, 0.4, 0.6)"), Some(0.4));
++
++    assert_eq!(as_number("z-index", "calc(2)"), Some(2.0));
++    assert_eq!(as_number("z-index", "min(1, 3)"), Some(1.0));
++    assert_eq!(as_number("z-index", "max(5, 3)"), Some(5.0));
++    assert_eq!(as_number("z-index", "clamp(1, 4, 6)"), Some(4.0));
++}
+-- 
+2.43.0
+
diff --git a/local_patches/ahead-two-commits.patch b/local_patches/ahead-two-commits.patch
new file mode 100644
index 0000000..838e8e7
--- /dev/null
+++ b/local_patches/ahead-two-commits.patch
@@ -0,0 +1,242 @@
+From 78778459c7c579e0e2403fba9ebc97eab9249838 Mon Sep 17 00:00:00 2001
+From: Wilson Lin <code@wilsonl.in>
+Date: Wed, 17 Dec 2025 23:44:30 -0500
+Subject: [PATCH 1/2] Support calc/min/max/clamp for numeric properties
+
+---
+ local_patches/5a7b075-calc-numeric.patch | 51 ++++++++++++++++++++++++
+ scratchpad.md                            |  2 +
+ tests/css_numeric_functions.rs           | 22 ++++++++++
+ 3 files changed, 75 insertions(+)
+ create mode 100644 local_patches/5a7b075-calc-numeric.patch
+ create mode 100644 tests/css_numeric_functions.rs
+
+diff --git a/local_patches/5a7b075-calc-numeric.patch b/local_patches/5a7b075-calc-numeric.patch
+new file mode 100644
+index 0000000..ea5714d
+--- /dev/null
++++ b/local_patches/5a7b075-calc-numeric.patch
+@@ -0,0 +1,51 @@
++From 5a7b07514b262d302d3d3ab1e4679e0e12b9606c Mon Sep 17 00:00:00 2001
++From: Wilson Lin <code@wilsonl.in>
++Date: Wed, 17 Dec 2025 23:44:30 -0500
++Subject: [PATCH] Support calc/min/max/clamp for numeric properties
++
++---
++ scratchpad.md                  |  1 +
++ tests/css_numeric_functions.rs | 22 ++++++++++++++++++++++
++ 2 files changed, 23 insertions(+)
++ create mode 100644 tests/css_numeric_functions.rs
++
++diff --git a/scratchpad.md b/scratchpad.md
++index 65320e1..d42cac6 100644
++--- a/scratchpad.md
+++++ b/scratchpad.md
++@@ -1617,3 +1617,4 @@ Rendered getbootstrap.com at 1200×800: content fills viewport (bbox 0,12–1199
++ - fetch_and_render now uses HttpFetcher for network fetches (UA override honored), and render_pages logs the UA per-page to match runtime fetcher behavior.
++ - Unitless zero values now parse as numbers for opacity/z-index, avoiding bogus length parsing that could block overlays (e.g., wired.com); regression added.
++ - Push of the above scratchpad note pending; git push timing out (commit 363dbfd queued). Patch saved at local_patches/363dbfd-note-unitless-zero.patch for sharing.
+++- Numeric calc/min/max/clamp now parse for opacity/z-index: property parser accepts calc()/min()/max()/clamp() as numbers for numeric properties, with regression tests in css_numeric_functions.rs.
++diff --git a/tests/css_numeric_functions.rs b/tests/css_numeric_functions.rs
++new file mode 100644
++index 0000000..df8c18b
++--- /dev/null
+++++ b/tests/css_numeric_functions.rs
++@@ -0,0 +1,22 @@
+++use fastrender::css::properties::parse_property_value;
+++use fastrender::css::types::PropertyValue;
+++
+++fn as_number(prop: &str, value: &str) -> Option<f32> {
+++    match parse_property_value(prop, value)? {
+++        PropertyValue::Number(n) => Some(n),
+++        _ => None,
+++    }
+++}
+++
+++#[test]
+++fn numeric_properties_accept_calc_min_max_clamp() {
+++    assert_eq!(as_number("opacity", "calc(0.5)"), Some(0.5));
+++    assert_eq!(as_number("opacity", "min(0.5, 0.7)"), Some(0.5));
+++    assert_eq!(as_number("opacity", "max(0.3, 0.7)"), Some(0.7));
+++    assert_eq!(as_number("opacity", "clamp(0.2, 0.4, 0.6)"), Some(0.4));
+++
+++    assert_eq!(as_number("z-index", "calc(2)"), Some(2.0));
+++    assert_eq!(as_number("z-index", "min(1, 3)"), Some(1.0));
+++    assert_eq!(as_number("z-index", "max(5, 3)"), Some(5.0));
+++    assert_eq!(as_number("z-index", "clamp(1, 4, 6)"), Some(4.0));
+++}
++-- 
++2.43.0
++
+diff --git a/scratchpad.md b/scratchpad.md
+index 65320e1..dffca9b 100644
+--- a/scratchpad.md
++++ b/scratchpad.md
+@@ -1617,3 +1617,5 @@ Rendered getbootstrap.com at 1200×800: content fills viewport (bbox 0,12–1199
+ - fetch_and_render now uses HttpFetcher for network fetches (UA override honored), and render_pages logs the UA per-page to match runtime fetcher behavior.
+ - Unitless zero values now parse as numbers for opacity/z-index, avoiding bogus length parsing that could block overlays (e.g., wired.com); regression added.
+ - Push of the above scratchpad note pending; git push timing out (commit 363dbfd queued). Patch saved at local_patches/363dbfd-note-unitless-zero.patch for sharing.
++- Numeric calc/min/max/clamp now parse for opacity/z-index: property parser accepts calc()/min()/max()/clamp() as numbers for numeric properties, with regression tests in css_numeric_functions.rs.
++- Pushes currently timing out; latest numeric calc support saved as patch local_patches/5a7b075-calc-numeric.patch (commit 5a7b075 queued).
+diff --git a/tests/css_numeric_functions.rs b/tests/css_numeric_functions.rs
+new file mode 100644
+index 0000000..df8c18b
+--- /dev/null
++++ b/tests/css_numeric_functions.rs
+@@ -0,0 +1,22 @@
++use fastrender::css::properties::parse_property_value;
++use fastrender::css::types::PropertyValue;
++
++fn as_number(prop: &str, value: &str) -> Option<f32> {
++    match parse_property_value(prop, value)? {
++        PropertyValue::Number(n) => Some(n),
++        _ => None,
++    }
++}
++
++#[test]
++fn numeric_properties_accept_calc_min_max_clamp() {
++    assert_eq!(as_number("opacity", "calc(0.5)"), Some(0.5));
++    assert_eq!(as_number("opacity", "min(0.5, 0.7)"), Some(0.5));
++    assert_eq!(as_number("opacity", "max(0.3, 0.7)"), Some(0.7));
++    assert_eq!(as_number("opacity", "clamp(0.2, 0.4, 0.6)"), Some(0.4));
++
++    assert_eq!(as_number("z-index", "calc(2)"), Some(2.0));
++    assert_eq!(as_number("z-index", "min(1, 3)"), Some(1.0));
++    assert_eq!(as_number("z-index", "max(5, 3)"), Some(5.0));
++    assert_eq!(as_number("z-index", "clamp(1, 4, 6)"), Some(4.0));
++}
+-- 
+2.43.0
+
+
+From bf45ba4f6d932165649113428f3a78719398af46 Mon Sep 17 00:00:00 2001
+From: Wilson Lin <code@wilsonl.in>
+Date: Wed, 17 Dec 2025 23:56:49 -0500
+Subject: [PATCH 2/2] Add patch export for numeric calc support
+
+---
+ ...min-max-clamp-for-numeric-properties.patch | 111 ++++++++++++++++++
+ 1 file changed, 111 insertions(+)
+ create mode 100644 0001-Support-calc-min-max-clamp-for-numeric-properties.patch
+
+diff --git a/0001-Support-calc-min-max-clamp-for-numeric-properties.patch b/0001-Support-calc-min-max-clamp-for-numeric-properties.patch
+new file mode 100644
+index 0000000..522fff6
+--- /dev/null
++++ b/0001-Support-calc-min-max-clamp-for-numeric-properties.patch
+@@ -0,0 +1,111 @@
++From 78778459c7c579e0e2403fba9ebc97eab9249838 Mon Sep 17 00:00:00 2001
++From: Wilson Lin <code@wilsonl.in>
++Date: Wed, 17 Dec 2025 23:44:30 -0500
++Subject: [PATCH] Support calc/min/max/clamp for numeric properties
++
++---
++ local_patches/5a7b075-calc-numeric.patch | 51 ++++++++++++++++++++++++
++ scratchpad.md                            |  2 +
++ tests/css_numeric_functions.rs           | 22 ++++++++++
++ 3 files changed, 75 insertions(+)
++ create mode 100644 local_patches/5a7b075-calc-numeric.patch
++ create mode 100644 tests/css_numeric_functions.rs
++
++diff --git a/local_patches/5a7b075-calc-numeric.patch b/local_patches/5a7b075-calc-numeric.patch
++new file mode 100644
++index 0000000..ea5714d
++--- /dev/null
+++++ b/local_patches/5a7b075-calc-numeric.patch
++@@ -0,0 +1,51 @@
+++From 5a7b07514b262d302d3d3ab1e4679e0e12b9606c Mon Sep 17 00:00:00 2001
+++From: Wilson Lin <code@wilsonl.in>
+++Date: Wed, 17 Dec 2025 23:44:30 -0500
+++Subject: [PATCH] Support calc/min/max/clamp for numeric properties
+++
+++---
+++ scratchpad.md                  |  1 +
+++ tests/css_numeric_functions.rs | 22 ++++++++++++++++++++++
+++ 2 files changed, 23 insertions(+)
+++ create mode 100644 tests/css_numeric_functions.rs
+++
+++diff --git a/scratchpad.md b/scratchpad.md
+++index 65320e1..d42cac6 100644
+++--- a/scratchpad.md
++++++ b/scratchpad.md
+++@@ -1617,3 +1617,4 @@ Rendered getbootstrap.com at 1200×800: content fills viewport (bbox 0,12–1199
+++ - fetch_and_render now uses HttpFetcher for network fetches (UA override honored), and render_pages logs the UA per-page to match runtime fetcher behavior.
+++ - Unitless zero values now parse as numbers for opacity/z-index, avoiding bogus length parsing that could block overlays (e.g., wired.com); regression added.
+++ - Push of the above scratchpad note pending; git push timing out (commit 363dbfd queued). Patch saved at local_patches/363dbfd-note-unitless-zero.patch for sharing.
++++- Numeric calc/min/max/clamp now parse for opacity/z-index: property parser accepts calc()/min()/max()/clamp() as numbers for numeric properties, with regression tests in css_numeric_functions.rs.
+++diff --git a/tests/css_numeric_functions.rs b/tests/css_numeric_functions.rs
+++new file mode 100644
+++index 0000000..df8c18b
+++--- /dev/null
++++++ b/tests/css_numeric_functions.rs
+++@@ -0,0 +1,22 @@
++++use fastrender::css::properties::parse_property_value;
++++use fastrender::css::types::PropertyValue;
++++
++++fn as_number(prop: &str, value: &str) -> Option<f32> {
++++    match parse_property_value(prop, value)? {
++++        PropertyValue::Number(n) => Some(n),
++++        _ => None,
++++    }
++++}
++++
++++#[test]
++++fn numeric_properties_accept_calc_min_max_clamp() {
++++    assert_eq!(as_number("opacity", "calc(0.5)"), Some(0.5));
++++    assert_eq!(as_number("opacity", "min(0.5, 0.7)"), Some(0.5));
++++    assert_eq!(as_number("opacity", "max(0.3, 0.7)"), Some(0.7));
++++    assert_eq!(as_number("opacity", "clamp(0.2, 0.4, 0.6)"), Some(0.4));
++++
++++    assert_eq!(as_number("z-index", "calc(2)"), Some(2.0));
++++    assert_eq!(as_number("z-index", "min(1, 3)"), Some(1.0));
++++    assert_eq!(as_number("z-index", "max(5, 3)"), Some(5.0));
++++    assert_eq!(as_number("z-index", "clamp(1, 4, 6)"), Some(4.0));
++++}
+++-- 
+++2.43.0
+++
++diff --git a/scratchpad.md b/scratchpad.md
++index 65320e1..dffca9b 100644
++--- a/scratchpad.md
+++++ b/scratchpad.md
++@@ -1617,3 +1617,5 @@ Rendered getbootstrap.com at 1200×800: content fills viewport (bbox 0,12–1199
++ - fetch_and_render now uses HttpFetcher for network fetches (UA override honored), and render_pages logs the UA per-page to match runtime fetcher behavior.
++ - Unitless zero values now parse as numbers for opacity/z-index, avoiding bogus length parsing that could block overlays (e.g., wired.com); regression added.
++ - Push of the above scratchpad note pending; git push timing out (commit 363dbfd queued). Patch saved at local_patches/363dbfd-note-unitless-zero.patch for sharing.
+++- Numeric calc/min/max/clamp now parse for opacity/z-index: property parser accepts calc()/min()/max()/clamp() as numbers for numeric properties, with regression tests in css_numeric_functions.rs.
+++- Pushes currently timing out; latest numeric calc support saved as patch local_patches/5a7b075-calc-numeric.patch (commit 5a7b075 queued).
++diff --git a/tests/css_numeric_functions.rs b/tests/css_numeric_functions.rs
++new file mode 100644
++index 0000000..df8c18b
++--- /dev/null
+++++ b/tests/css_numeric_functions.rs
++@@ -0,0 +1,22 @@
+++use fastrender::css::properties::parse_property_value;
+++use fastrender::css::types::PropertyValue;
+++
+++fn as_number(prop: &str, value: &str) -> Option<f32> {
+++    match parse_property_value(prop, value)? {
+++        PropertyValue::Number(n) => Some(n),
+++        _ => None,
+++    }
+++}
+++
+++#[test]
+++fn numeric_properties_accept_calc_min_max_clamp() {
+++    assert_eq!(as_number("opacity", "calc(0.5)"), Some(0.5));
+++    assert_eq!(as_number("opacity", "min(0.5, 0.7)"), Some(0.5));
+++    assert_eq!(as_number("opacity", "max(0.3, 0.7)"), Some(0.7));
+++    assert_eq!(as_number("opacity", "clamp(0.2, 0.4, 0.6)"), Some(0.4));
+++
+++    assert_eq!(as_number("z-index", "calc(2)"), Some(2.0));
+++    assert_eq!(as_number("z-index", "min(1, 3)"), Some(1.0));
+++    assert_eq!(as_number("z-index", "max(5, 3)"), Some(5.0));
+++    assert_eq!(as_number("z-index", "clamp(1, 4, 6)"), Some(4.0));
+++}
++-- 
++2.43.0
++
+-- 
+2.43.0
+
diff --git a/scratchpad.md b/scratchpad.md
index c8f4709..e4a7723 100644
--- a/scratchpad.md
+++ b/scratchpad.md
@@ -1620,3 +1620,4 @@ Rendered getbootstrap.com at 1200×800: content fills viewport (bbox 0,12–1199
 - Push of the above scratchpad note pending; git push timing out (commit 363dbfd queued). Patch saved at local_patches/363dbfd-note-unitless-zero.patch for sharing.
 - Numeric calc/min/max/clamp now parse for opacity/z-index: property parser accepts calc()/min()/max()/clamp() as numbers for numeric properties, with regression tests in css_numeric_functions.rs.
 - Pushes currently timing out; latest numeric calc support saved as patch local_patches/5a7b075-calc-numeric.patch (commit 5a7b075 queued).
+- Exports for pending commits while push times out: 0001-Support-calc-min-max-clamp-for-numeric-properties.patch and local_patches/ahead-two-commits.patch capture current ahead-of-origin state.
-- 
2.43.0

